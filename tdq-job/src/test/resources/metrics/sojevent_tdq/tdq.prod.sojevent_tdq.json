{
  "id": "ignore",
  "env": {
    "config": {
      "flink.app.local-aggr.queue-size": 1000,
      "flink.app.window.metric-1st-aggr": "1min",
      "flink.app.local-aggr.flush-timeout": "5s",
      "flink.app.parallelism.metric-1st-aggr": 30,
      "flink.app.parallelism.metric-2nd-aggr": 2,
      "flink.app.local-aggr.output-partitions": 13
    }
  },
  "name": "ignore",
  "rules": [
    {
      "name": "system",
      "type": "realtime.rheos.profiler",
      "config": {
        "window": "1min"
      },
      "profilers": [
        {
          "expr": "total_cnt",
          "metric-name": "sojevent_system_metric",
          "transformations": [
            {
              "expr": "count(1)",
              "alias": "total_cnt"
            }
          ]
        }
      ]
    },
    {
      "name": "ido",
      "type": "realtime.rheos.profiler",
      "config": {
        "window": "5min"
      },
      "profilers": [
        {
          "expr": "total_cnt",
          "dimensions": [
            "domain",
            "site_id",
            "page_id"
          ],
          "metric-name": "sojevent_common_metric",
          "transformations": [
            {
              "expr": "CAST(applicationPayload.p AS INTEGER)",
              "alias": "page_id",
              "filter": "page_id in (2547208,2483445,2047936,2054032,2053742,2045573,2351460,2381081)"
            },
            {
              "expr": "soj_page_family(CAST(applicationPayload.p AS INTEGER))",
              "alias": "domain"
            },
            {
              "expr": "CAST(applicationPayload.t AS INTEGER)",
              "alias": "site_id"
            },
            {
              "expr": "count(1)",
              "alias": "total_cnt"
            },
            {
              "expr": "count(1)",
              "alias": "st_total_cnt",
              "filter": "page_id in (2047936,2054032,2053742,2045573) or (page_id in (2351460,2381081) and applicationPayload.eactn is not null)"
            },
            {
              "expr": "sum(case when LENGTH(applicationPayload.prof) > 0 then 1 else 0 end)",
              "alias": "st_prof_cnt",
              "filter": "page_id in (2047936,2054032,2053742,2045573) or (page_id in (2351460,2381081) and applicationPayload.eactn is not null)"
            }
          ]
        }
      ]
    }
  ],
  "sinks": [
    {
      "name": "pronto_normal_metric",
      "type": "realtime.pronto",
      "config": {
        "sub-type": "normal-metric",
        "index-pattern": "tdq.${flink.app.profile}.metric.normal."
      }
    },
    {
      "name": "pronto_latency_metric",
      "type": "realtime.pronto",
      "config": {
        "sub-type": "latency-metric",
        "index-pattern": "tdq.${flink.app.profile}.metric.latency."
      }
    },
    {
      "name": "pronto_exception",
      "type": "realtime.pronto",
      "config": {
        "sub-type": "exception-log",
        "index-pattern": "tdq.${flink.app.profile}.log.exception."
      }
    },
    {
      "name": "pronto_sample",
      "type": "realtime.pronto",
      "config": {
        "sub-type": "sample-log",
        "index-pattern": "tdq.${flink.app.profile}.log.sample."
      }
    }
  ],
  "sources": [
    {
      "name": "kafka_sojevent_tdq_rno",
      "type": "realtime.kafka",
      "config": {
        "stream": "behavior.pulsar",
        "topics": "behavior.pulsar.customized.tdq",
        "deserializer": "com.ebay.tdq.connector.kafka.schema.TdqEventDeserializationSchema",
        "startup-mode": "TIMESTAMP",
        "from-timestamp": 1629948000000,
        "kafka-consumer": {
          "receive.buffer": 8388608,
          "sasl.mechanism": "IAF",
          "fetch.max.bytes": 52428800,
          "max.poll.records": 5000,
          "sasl.jaas.config": "io.ebay.rheos.kafka.security.iaf.IAFLoginModule required iafConsumerId=\"urn:ebay-marketplace-consumerid:68a97ac2-013b-4915-9ed7-d6ae2ff01618\" iafSecret=\"c4bb6fca-7ac5-46dd-b218-a49cb6307dbc\" iafEnv=\"production\";",
          "auto.offset.reset": "latest",
          "bootstrap.servers": "rhs-okrvkiaa-kfk-rno-1.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-2.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-3.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-4.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-5.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-6.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-7.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-8.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-9.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-10.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-11.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-12.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-13.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-14.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-15.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-16.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-17.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-18.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-19.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-20.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-21.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-22.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-23.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-24.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-25.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-26.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-27.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-28.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-29.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-30.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-31.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-32.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-33.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-34.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-35.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-36.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-37.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-38.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-39.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-40.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-41.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-42.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-43.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-44.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-45.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-46.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-47.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-48.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-49.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-50.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-51.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-52.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-53.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-54.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-55.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-56.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-57.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-58.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-59.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-60.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-61.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-62.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-63.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-64.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-65.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-66.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-67.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-68.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-69.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-70.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-71.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-72.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-73.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-74.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-75.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-76.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-77.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-78.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-79.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-80.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-81.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-82.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-83.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-84.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-85.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-86.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-87.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-88.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-89.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-90.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-91.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-92.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-93.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-94.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-95.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-96.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-97.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-98.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-99.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-100.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-101.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-102.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-103.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-104.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-105.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-106.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-107.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-108.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-109.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-110.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-111.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-112.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-113.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-114.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-115.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-116.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-117.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-118.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-119.rheos-streaming-prod.svc.25.tess.io:9092,rhs-okrvkiaa-kfk-rno-120.rheos-streaming-prod.svc.25.tess.io:9092",
          "fetch.max.wait.ms": 100,
          "security.protocol": "SASL_PLAINTEXT",
          "max.partition.fetch.bytes": 10485760,
          "partition.assignment.strategy": "org.apache.kafka.clients.consumer.RoundRobinAssignor",
          "flink.partition-discovery.interval-millis": 30000
        },
        "schema-subject": "behavior.sojourner.sojevent.schema",
        "rhs-parallelism": 30,
        "event-time-field": "eventTimestamp",
        "rhs-idle-timeout": "3min",
        "rheos-services-urls": "https://rheos-services.stratus.ebay.com",
        "rhs-out-of-orderless": "3min"
      }
    }
  ]
}