{
  "rules": [
    {
      "name": "GLOBAL_MANDATORY_TAG_ITEM_RATE",
      "type": "realtime.rheos.profiler",
      "config": {
        "window": "1h"
      },
      "profilers": [
        {
          "desc": "Global Mandatory Tag - Item Rate",
          "metric-name": "GLOBAL_MANDATORY_TAG_ITEM_RATE",
          "expression": {
            "operator": "/",
            "params": {
              "columns": ["itm_valid_cnt", "itm_missing_cnt"]
            }
          },
          "transformations": [
            {
              "alias": "site_id",
              "data_type": "string",
              "expression": {
                "operator": "site_id_extract"
              }
            },
            {
              "alias": "page_family",
              "data_type": "string",
              "expression": {
                "operator": "page_family_extract"
              }
            },
            {
              "alias": "itm_str",
              "expression": {
                "operator": "itm_extract",
                "data_type": "string",
                "params": {
                  "columns": ["itm|itmid|itm_id|itmlist|litm"]
                }
              }
            },
            {
              "alias": "u_str",
              "expression": {
                "operator": "tag_extract",
                "data_type": "string",
                "params": {
                  "columns": ["u"]
                }
              }
            },
            {
              "alias": "itm_missing_cnt",
              "expression": {
                "operator": "Count",
                "params": {
                  "columns": ["itm_str"]
                }
              },
              "filter": "itm_str is null"
            },
            {
              "alias": "itm_valid_cnt",
              "expression": {
                "operator": "Count"
              },
              "filter": "length(regexp_extract(itm_str, '^(\\d+(%2C)?)+$', 1)) > 0"
            }
          ],
          "dimensions": ["pageFamily"]
        }
      ]
    },
    {
      "name": "EVENT_CAPTURE_PUBLISH_LATENCY",
      "type": "realtime.rheos.profiler",
      "config": {
        "window": "30m"
      },
      "profilers": [
        {
          "desc": "Event Capture Publish Latency",
          "metric-name": "EVENT_CAPTURE_PUBLISH_LATENCY",
          "expression": {
            "operator": "Sum",
            "params": {
              "columns": ["tduration"]
            }
          },
          "transformations": [
            {
              "alias": "pageIds",
              "expression": {
                "operator": "page_id_extract"
              }
            },
            {
              "alias": "tduration_str",
              "expression": {
                "operator": "tag_extract",
                "config" : {
                  "arg0" : "tduration"
                }
              }
            },
            {
              "alias": "tduration",
              "expression": {
                "operator": "cast",
                "params_TODO": {
                  "columns": ["tduration_str"]
                },
                "config_TODO" : {
                  "arg0" : "tduration_str",
                  "arg1" : "Double"
                }
              }
            }
          ],
          "filter": "pageId in ('2547208', '2483445')",
          "dimensions": ["pageId"]
        }
      ]
    }
  ]
}