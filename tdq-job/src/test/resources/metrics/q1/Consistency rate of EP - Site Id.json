{
  "id": "30", "name": "cfg_30", "rules": [
  {
    "name": "30", "type": "realtime.rheos.profiler", "config": {"window": "5min"}, "profilers": [
    {
      "metric-name": "common_metric",
      "expr": "ep_site_incon_cnt / total_cnt",
      "dimensions": ["domain", "site_id"],
      "transformations": [
        {"alias": "soj_tag_p",        "expr": "soj_nvl('p')"},
        {"alias": "soj_tag_es",       "expr": "soj_nvl('es')"},
        {"alias": "soj_tag_t",        "expr": "soj_nvl('t')"},
        {"alias": "soj_tag_duration", "expr": "soj_nvl('TDuration')"},

        {"alias": "domain",           "expr": "soj_page_family(CAST(soj_tag_p AS INTEGER))"},
        {"alias": "site_id",          "expr": "CAST(soj_tag_t AS INTEGER)"},

        {"alias": "total_cnt",        "expr": "count(1)"},
        {"alias": "ep_site_incon_cnt",  "expr": "sum(case when length(soj_tag_t)>0 and length(soj_tag_es)>0 and soj_tag_t = soj_tag_es then 0 else 1 end)"}
      ]
    }
  ]}
]}