{
  "source": {},
  "sink": {},
  "rules": [
    {
      "name": "${RULE_ID}",
      "type": "realtime.rheos.profiler",
      "config": {
        "window": "1h"
      },
      "profilers": [
        {
          "comment": "Global Mandatory Tag - Item Rate",
          "metric-name": "global_mandatory_tag_item_rate",
          "expression": {
            "operator": "Expr",
            "config": {"text": "itm_valid_cnt / itm_cnt"}
          },
          "transformation": [
            {
              "alias": "item",
              "expression": {
                "operator": "UDF",
                "config": {"text": "TAG_EXTRACT(__rawEvent, 'itm|itmid|itm_id|itmlist|litm')"}
              }
            },
            {
              "alias": "domain",
              "expression": {
                "operator": "UDF",
                "config": {"text": "PAGE_FAMILY(__RAW_EVENT)"}
              }
            },
            {
              "alias": "itm_ind",
              "expression": {
                "operator": "Expr",
                "config": {"text": "case when item IS NOT NULL and LENGTH( REGEXP_EXTRACT(item, '^(\\d+(%2C)?)+$', 1) ) > 0 then 1 else 0 end"}
              }
            },
            {
              "alias": "itm_valid_cnt",
              "expression": {
                "operator": "Sum",
                "config": {
                  "arg0": "itm_ind"
                }
              }
            },
            {
              "alias": "itm_cnt",
              "expression": {
                "operator": "Count"
              }
            }
          ],
          "dimensions": ["domain"],
          "filter": "a in('a''b') and b in ('1','1')"
        }
      ]
    }
  ]
}