{
  "data.sources": [
    {
      "name": "TBD",
      "connector": {
        "type": "kafka",
        "version": "0.11",
        "config": {
          "kafka.config": {
            "bootstrap.servers": "10.147.177.107:9092",
            "group.id": "group1",
            "auto.offset.reset": "smallest",
            "auto.commit.enable": "false"
          },
          "topics": "ttt",
          "key.type": "java.lang.String",
          "value.type": "java.lang.String"
        }
      }
    },
    {
      "name": "t",
      "connector": {
        "type": "soj",
        "topics": "behavior.pathfinder.events.total"
      }
    }
  ],
  "evaluate.rule": {
    "rules": [
      {
        "rule.name": "TBD",
        "dsl.type": "flink-sql"
      },
      {
        "rule.name": "TBD",
        "dsl.type": "flink-ds-ops",
        "desc": "sample|uniqueness"
      },
      {
        "rule.name": "TBD",
        "dsl.type": "tdq-dsl",
        "dq.type": "sample",
        "desc": "sample record out|uniqueness complex sql",
        "out": [
          {
            "name": "TBD",
            "type": "record",
            "sink": ["CONSOLESink"]
          }
        ]
      },
      {
        "rule.name": "t2",
        "source": "t",
        "dsl.type": "tdq-dsl",
        "dq.type": "profiling",
        "out": [
          {
            "name": "out1",
            "type": "metric",
            "desc": "default all details",
            "sink": ["SHERLOCKSink"]
          }
        ],
        "window": {
          "watermark": {
            "columnName": "eventTimestamp",
            "size": "1 HOUR"
          }
        },
        "advance": {
          "desc": "TBD",
          "preKeyBy": {
            "columnName": "guid",
            "window": {
              "watermark": {
                "columnName": "eventTimestamp",
                "size": "5 MINUTE"
              }
            },
            "out": {
              "name": "out3",
              "type": "metric",
              "metric.names": ["MISS_COUNT"]
            }
          }
        },
        "details": [
          {
            "metricName": "MISS_COUNT",
            "desc": "select pageFamilies, count(1) from t where pageFamilies IN ('ASQ', 'BID', 'BIDFLOW', 'BIN', 'BINFLOW', 'CART', 'OFFER', 'UNWTCH', 'VI', 'WTCH', 'XO') GROUP BY pageFamilies",
            "expression": "count(1)",
            "filter": [
              {
                "columnName": "tags.itm",
                "type": "isNull"
              },
              {
                "columnName": "pageFamilies",
                "type": "enumeration",
                "caseInsensitive": true,
                "values": [
                  "ASQ", "BID", "BIDFLOW", "BIN", "BINFLOW", "CART", "OFFER", "UNWTCH", "VI", "WTCH", "XO"
                ]
              }
            ],
            "dimension": ["pageFamilies"]
          },
          {
            "metricName": "PAGE_ID_COUNT",
            "desc": "select pageIds, count(1) from t where pageIds in (2547208, 2483445) group by pageIds",
            "expression": "count(1)",
            "filter": [
              {
                "columnName": "pageIds",
                "type": "enumeration",
                "values": [2547208, 2483445]
              }
            ],
            "dimension": ["pageIds"]
          },
          {
            "metricName": "PAGE_ID_COUNT2",
            "desc": "select count(1) from t where pageIds in (2547208, 2483445)",
            "expression": "count(1)",
            "filter": [
              {
                "columnName": "pageIds",
                "type": "enumeration",
                "values": [2547208, 2483445]
              }
            ]
          },
          {
            "metricName": "TAGS_U_VALIDATE_COUNT",
            "desc": "select count(1) from t where isInteger(tags.u)",
            "expression": "count(1)",
            "filter": [
              {
                "columnName": "tags.u",
                "type": "isInteger"
              }
            ]
          },
          {
            "metricName": "DEMO1",
            "desc": "select count(1) from t where user in (1,2,hive_none,null)",
            "expression": "count(1)",
            "filter": {
              "columnName": "user",
              "type": "enumeration",
              "values": ["1", "2", "hive_none", ""]
            }
          },
          {
            "metricName": "DEMO2",
            "desc": "select count(1) from t where regex(name,'^zhanglei.natur\\w{1}$')",
            "expression": "count(1)",
            "filter": {
              "columnName": "name",
              "type": "regex",
              "values": ["^zhanglei.natur\\w{1}$"]
            }
          },
          {
            "metricName": "EVENT_CAPTURE_PUBLISH_LATENCY",
            "desc": "select sum(cast(tags.TDuration as Double)) from t",
            "expression": "sum(td)",
            "transformation": [
              {
                "columnName": "tags.TDuration",
                "alias": "td",
                "columnType": "double",
                "columnTypeCast": true
              }
            ]
          }
        ]
      }
    ]
  },
  "sinks": [
    {
      "name": "CONSOLESink",
      "type": "CONSOLE",
      "config": {
        "max.log.lines": 100
      }
    },
    {
      "name": "SHERLOCKSink",
      "type": "SHERLOCK"
    },
    {
      "name": "TBD",
      "type": "HDFS"
    }
  ]
}

