{
  "id": "30", "name": "cfg_30", "rules": [
  {
    "name": "30", "type": "realtime.rheos.profiler", "config": {"window": "5min"}, "profilers": [
    {
      "metric-name": "common_metric",
      "expr": "st_prof_cnt / st_total_cnt",
      "dimensions": ["domain", "site_id"],
      "filter": "page_id in (2047936,2054032,2053742,2045573) or (page_id in (2351460,2381081) and soj_tag_eactn is not null)",
      "transformations": [
        {"alias": "soj_tag_p",         "expr": "soj_nvl('p')"},
        {"alias": "soj_tag_t",         "expr": "soj_nvl('t')"},
        {"alias": "soj_tag_app",       "expr": "soj_nvl('app')"},
        {"alias": "soj_tag_eactn",       "expr": "soj_nvl('eactn')"},

        {"alias": "soj_tag_cpnip",     "expr": "soj_nvl('cpnip')"},
        {"alias": "soj_tag_icpp",      "expr": "soj_nvl('icpp')"},
        {"alias": "soj_tag_prof",      "expr": "soj_nvl('prof')"},
        {"alias": "soj_tag_clktrack",  "expr": "soj_nvl('!clktrack')"},

        {"alias": "domain",           "expr": "soj_page_family(CAST(soj_tag_p AS INTEGER))"},
        {"alias": "site_id",          "expr": "CAST(soj_tag_t AS INTEGER)"},
        {"alias": "app",              "expr": "soj_tag_app"},
        {"alias": "page_id",          "expr": "CAST(soj_tag_p AS INTEGER)"},

        {"alias": "st_total_cnt",     "expr": "count(1)"},
        {"alias": "st_cpnip_cnt",     "expr": "sum(case when LENGTH(soj_tag_cpnip) > 0 then 1 else 0 end)"},
        {"alias": "st_icpp_cnt",      "expr": "sum(case when LENGTH(soj_tag_icpp) > 0 then 1 else 0 end)"},
        {"alias": "st_prof_cnt",      "expr": "sum(case when LENGTH(soj_tag_prof) > 0 then 1 else 0 end)"},
        {"alias": "st_clktrack_cnt",  "expr": "sum(case when LENGTH(soj_tag_clktrack) > 0 then 1 else 0 end)"}
      ]
    }
  ]}
]}