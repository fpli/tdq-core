{
  "id": "30",
  "name": "cfg_30",
  "rules": [
    {
      "name": "30",
      "type": "realtime.rheos.profiler",
      "config": {
        "window": "5min"
      },
      "profilers": [
        {
          "metric-name": "common_metric",
          "expr": "total_cnt",
          "dimensions": [
            "domain",
            "site_id",
            "app",
            "page_id"
          ],
          "transformations": [
            {
              "alias": "soj_tag_p",
              "expr": "soj_nvl('p')"
            },
            {
              "alias": "soj_tag_u",
              "expr": "soj_nvl('u')"
            },
            {
              "alias": "soj_tag_t",
              "expr": "soj_nvl('t')"
            },
            {
              "alias": "soj_tag_itm",
              "expr": "soj_nvl('itm|itmid|itm_id|itmlist|litm')"
            },
            {
              "alias": "soj_tag_mav",
              "expr": "soj_nvl('mav')"
            },
            {
              "alias": "soj_tag_dn",
              "expr": "soj_nvl('dn')"
            },
            {
              "alias": "soj_tag_mos",
              "expr": "soj_nvl('mos')"
            },
            {
              "alias": "soj_tag_osv",
              "expr": "soj_nvl('osv')"
            },
            {
              "alias": "soj_tag_es",
              "expr": "soj_nvl('es')"
            },
            {
              "alias": "soj_tag_app",
              "expr": "soj_nvl('app')"
            },
            {
              "alias": "soj_tag_duration",
              "expr": "soj_nvl('TDuration')"
            },
            {
              "alias": "soj_tag_cpnip",
              "expr": "soj_nvl('cpnip')"
            },
            {
              "alias": "soj_tag_icpp",
              "expr": "soj_nvl('icpp')"
            },
            {
              "alias": "soj_tag_prof",
              "expr": "soj_nvl('prof')"
            },
            {
              "alias": "soj_tag_clktrack",
              "expr": "soj_nvl('!clktrack')"
            },
            {
              "alias": "soj_tag_eactn",
              "expr": "soj_nvl('eactn')"
            },
            {
              "alias": "app",
              "expr": "soj_tag_app",
              "filter": "app in ('2571','1462','2878')"
            },
            {
              "alias": "page_id",
              "expr": "CAST(soj_tag_p AS INTEGER)",
              "filter": "page_id in (2547208, 2483445)"
            },
            {
              "alias": "domain",
              "expr": "soj_page_family(CAST(soj_tag_p AS INTEGER))"
            },
            {
              "alias": "site_id",
              "expr": "CAST(soj_tag_t AS INTEGER)"
            },
            {
              "alias": "usr_id",
              "expr": "CAST(soj_tag_u AS LONG)"
            },
            {
              "alias": "total_cnt",
              "expr": "count(1)"
            },
            {
              "alias": "duration_sum",
              "expr": "sum(CAST(soj_tag_duration AS DOUBLE))"
            },
            {
              "alias": "gmt_total_cnt",
              "expr": "count(1)",
              "filter": "domain in ('ASQ','BID','BIDFLOW','BIN','BINFLOW','CART','OFFER','UNWTCH','VI','WTCH','XO')"
            },
            {
              "alias": "gmt_usr_cnt",
              "expr": "sum(case when LENGTH(soj_tag_u) > 0 then 1 else 0 end)",
              "filter": "domain in ('ASQ','BID','BIDFLOW','BIN','BINFLOW','CART','OFFER','UNWTCH','VI','WTCH','XO')"
            },
            {
              "alias": "gmt_itm_cnt",
              "expr": "sum(case when LENGTH(soj_tag_itm) > 0 then 1 else 0 end)",
              "filter": "domain in ('ASQ','BID','BIDFLOW','BIN','BINFLOW','CART','OFFER','UNWTCH','VI','WTCH','XO')"
            },
            {
              "alias": "nt_dn_cnt",
              "expr": "sum(case when LENGTH(soj_tag_dn) > 0 then 1 else 0 end)"
            },
            {
              "alias": "nt_mav_cnt",
              "expr": "sum(case when LENGTH(soj_tag_mav) > 0 then 1 else 0 end)"
            },
            {
              "alias": "nt_mos_cnt",
              "expr": "sum(case when LENGTH(soj_tag_mos) > 0 then 1 else 0 end)"
            },
            {
              "alias": "nt_osv_cnt",
              "expr": "sum(case when LENGTH(soj_tag_osv) > 0 then 1 else 0 end)"
            },
            {
              "alias": "ep_site_incon_cnt",
              "expr": "sum(case when soj_tag_t = soj_tag_es then 0 else 1 end)",
              "filter": "soj_tag_es is not null"
            },
            {
              "alias": "ep_site_total_cnt",
              "expr": "count(1)",
              "filter": "soj_tag_es is not null"
            },
            {
              "alias": "ut_err_cnt",
              "expr": "sum(case when ((soj_tag_u similar to '\\d+' and (usr_id <= 0 or usr_id > 9999999999999999)) or soj_tag_u not similar to '\\d+') then 1 else 0 end)"
            },
            {
              "alias": "st_total_cnt",
              "expr": "count(1)",
              "filter": "page_id in (2047936,2054032,2053742,2045573) or (page_id in (2351460,2381081) and soj_tag_eactn is not null)"
            },
            {
              "alias": "st_cpnip_cnt",
              "expr": "sum(case when LENGTH(soj_tag_cpnip) > 0 then 1 else 0 end)",
              "filter": "page_id in (2047936,2054032,2053742,2045573) or (page_id in (2351460,2381081) and soj_tag_eactn is not null)"
            },
            {
              "alias": "st_icpp_cnt",
              "expr": "sum(case when LENGTH(soj_tag_icpp) > 0 then 1 else 0 end)",
              "filter": "page_id in (2047936,2054032,2053742,2045573) or (page_id in (2351460,2381081) and soj_tag_eactn is not null)"
            },
            {
              "alias": "st_prof_cnt",
              "expr": "sum(case when LENGTH(soj_tag_prof) > 0 then 1 else 0 end)",
              "filter": "page_id in (2047936,2054032,2053742,2045573) or (page_id in (2351460,2381081) and soj_tag_eactn is not null)"
            },
            {
              "alias": "st_clktrack_cnt",
              "expr": "sum(case when LENGTH(soj_tag_clktrack) > 0 then 1 else 0 end)",
              "filter": "page_id in (2047936,2054032,2053742,2045573) or (page_id in (2351460,2381081) and soj_tag_eactn is not null)"
            }
          ]
        }
      ]
    }
  ]
}