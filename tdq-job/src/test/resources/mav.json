{
  "id": "17", "name": "cfg_17", "rules": [
  {
    "name": "rule_17",
    "type": "realtime.rheos.profiler",
    "config": {"window": "1min"},
    "profilers": [
      {
        "metric-name": "global_mandatory_tag_dn_rate",
        "comment": "Global Mandatory Tag - DN Rate",
        "expression": {"operator": "Expr", "config": {"text": "p1 / p2"}},
        "dimensions": ["domain", "site_id", "page_id", "app"],
        "transformations": [
          {
            "alias": "domain",
            "expression": {"operator": "UDF", "config": {"text": "PAGE_FAMILY(CAST(TAG_EXTRACT('p') AS INTEGER))"}}
          },
          {
            "alias": "site_id",
            "expression": {"operator": "UDF", "config": {"text": "CAST(TAG_EXTRACT('t') AS INTEGER)"}}
          },
          {"alias": "app", "expression": {"operator": "UDF", "config": {"text": "TAG_EXTRACT('app')"}}},
          {
            "alias": "page_id",
            "expression": {"operator": "UDF", "config": {"text": "CAST(TAG_EXTRACT('p') AS INTEGER)"}}
          },
          {"alias": "p2", "expression": {"operator": "Count", "config": {"arg0": "1.0"}}},
          {
            "alias": "p1",
            "expression": {
              "operator": "Sum",
              "config": {"arg0": "case when LENGTH(TAG_EXTRACT('dn')) > 0 then 1.0 else 0.0 end"}
            }
          }
        ]
      }
    ]
  }
]
}

